<!-- BACKGROUND  -->
<ng-container
    *ngIf="{
        weatherObject: weatherObject$ | async,
        locationList: locationList$ | async
    } as data"
>
    <div
        class="background-wrapper"
        *ngIf="data.weatherObject; else loadingBackground"
    >
        <div
            class="background"
            [ngStyle]="{
                'background-image': getBackgroundUrl(data.weatherObject)
            }"
        ></div>
    </div>

    <ng-template #loadingBackground>
        <div class="background-wrapper">
            <div
                class="background"
                [ngStyle]="{
                    'background-image': {
                        'location.localtime_epoch': getEpoch(),
                        'current.condition.code': 1000
                    }
                }"
            ></div>
        </div>
    </ng-template>

    <!-- SEARCH  -->
    <div class="flex column space-between full-width">
        <div class="top flex column">
            <div class="search">
                <label [class.hidden]="!isSearchFocused" for="location-search"
                    >Sök efter en ort</label
                >
                <input
                    #searchInput
                    id="location-search"
                    type="text"
                    list="location-list"
                    [placeholder]="isSearchFocused ? ' ' : 'Sök efter en ort'"
                    minlength="3"
                />
            </div>
            <ul id="location-list">
                <li *ngFor="let location of data.locationList">
                    <a
                        href="#"
                        id="{{ location.name }}"
                        (click)="weatherRequest($event)"
                        >{{ location.name }}</a
                    >
                </li>
            </ul>
        </div>
        <!-- CURRENT WEATHER -->
        <div class="center" *ngIf="data.weatherObject; else loadingCurrent">
            <!-- Main -->
            <h4 class="align-center mv-16">
                {{ data.weatherObject.location.name }}
            </h4>
            <h1 class="align-center mv-16">
                {{
                    data.weatherObject.current.temp_c | asFahrenheit: doConvert
                }}
            </h1>
            <h4 class="align-center mv-16">
                {{ data.weatherObject.current.condition.text }}
            </h4>
            <!-- Data points -->
            <div class="flex row space-between">
                <div class="flex column p-8">
                    <h5 class="p-8">MIN/MAX</h5>
                    <h4 class="p-8">
                        {{
                            data.weatherObject.forecast.forecastday[0].day
                                .mintemp_c | asFahrenheit: doConvert
                        }}
                        /
                        {{
                            data.weatherObject.forecast.forecastday[0].day
                                .maxtemp_c | asFahrenheit: doConvert
                        }}
                    </h4>
                </div>
                <div class="flex column p-8">
                    <h5 class="p-8">Vindhastighet</h5>
                    <h4 class="p-8">
                        {{
                            asMilesPerHour
                                ? (data.weatherObject.current.wind_kph
                                  | asMilesPerHour)
                                : (data.weatherObject.current.wind_kph
                                  | asMetersPerSecond)
                        }}
                    </h4>
                </div>

                <div class="flex column p-8">
                    <h5 class="p-8">Vindriktning</h5>
                    <h4 class="p-8">
                        {{ data.weatherObject.current.wind_dir }}
                    </h4>
                </div>

                <div class="flex column p-8">
                    <h5 class="p-8">Luftfuktighet</h5>
                    <h4 class="p-8">
                        {{ data.weatherObject.current.humidity }}%
                    </h4>
                </div>
            </div>
        </div>

        <ng-template #loadingCurrent>
            <div class="center">
                <!-- Main -->
                <h4 class="align-center mv-16">Name</h4>
                <h1 class="align-center mv-16">X</h1>
                <h4 class="align-center mv-16">xxxxxxx</h4>
                <!-- Data points -->
                <div class="flex row space-between">
                    <div class="flex column p-8">
                        <h5 class="p-8">MIN/MAX</h5>
                        <h4>Y / X</h4>
                    </div>
                    <div class="flex column p-8">
                        <h5 class="p-8">Vindhastighet</h5>
                        <h4 class="p-8">X m/s</h4>
                    </div>

                    <div class="flex column p-8">
                        <h5 class="p-8">Vindriktning</h5>
                        <h4 class="p-8">XYZ</h4>
                    </div>

                    <div class="flex column p-8">
                        <h5 class="p-8">Luftfuktighet</h5>
                        <h4 class="p-8">X %</h4>
                    </div>
                </div>
            </div>
        </ng-template>

        <!-- FORECAST -->

        <div *ngIf="data.weatherObject; else loadingForecast" class="top">
            <div class="flex row space-around">
                <div
                    *ngFor="let day of data.weatherObject.forecast.forecastday"
                    class="wrapper background-on-picture text-on-black"
                >
                    <span class="label p-8">{{ day.date }} </span>
                    <img class="-8" src="{{ day.day.condition.icon }}" />
                    <span class="thin-text p-8"
                        >{{ day.day.mintemp_c | asFahrenheit: doConvert }} /
                        {{ day.day.maxtemp_c | asFahrenheit: doConvert }}</span
                    >
                </div>
            </div>
        </div>

        <ng-template #loadingForecast>
            <div class="top">
                <div class="flex row space-around">
                    <div
                        *ngFor="let day of [1, 2, 3]"
                        class="wrapper background-on-picture text-on-black"
                    >
                        <span class="label p-8"> yyy - mm - dd </span>
                        <span>icon</span>
                        <span class="thin-text p-8">Y / Y</span>
                    </div>
                </div>
            </div>
        </ng-template>

        <!-- FOOTER -->
        <div class="center background-on-picture text-on-black p-8">
            Powered by
            <a
                href="https://www.weatherapi.com/"
                target="_blank"
                title="Weather API"
                >WeatherAPI.com</a
            >
        </div>
    </div>
</ng-container>
